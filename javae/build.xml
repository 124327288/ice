<!--
 **********************************************************************

 Copyright (c) 2003-2005 ZeroC, Inc. All rights reserved.

 This copy of Ice is licensed to you under the terms described in the
 ICE_LICENSE file included in this distribution.

 **********************************************************************
-->

<project name="main" default="all" basedir=".">

    <property name="top.dir" value="."/>

    <import file="config/common.xml"/>

    <path id="bootclasspath">
	<pathelement path="/opt/WTK2.2/lib/cldcapi11.jar"/>
	<pathelement path="/opt/WTK2.2/lib/midpapi20.jar"/>
    </path>

    <!-- set global properties for this build -->
    <property name="src.dir" value="src"/>
    <property name="lib.dir" value="lib"/>
    <property name="cache.dir" value="depcache"/>

    <target name="init" depends="config-init"/>

    <target name="generate" depends="init">
        <!-- Create the output directory for generated code -->
        <mkdir dir="${generated.dir}"/>
        <slice2javae ice="on" outputdir="${generated.dir}" dependencyfile="${generated.dir}/.depend.Ice">
            <includepath>
                <pathelement path="${slice.dir}" />
            </includepath>
            <fileset dir="${slice.dir}/Ice">
                <include name="BuiltinSequences.ice" />
                <include name="Communicator.ice" />
                <include name="Current.ice" />
                <include name="FacetMap.ice" />
                <include name="Identity.ice" />
                <include name="LocalException.ice" />
                <include name="Locator.ice" />
                <include name="Logger.ice" />
                <include name="ObjectAdapter.ice" />
                <include name="Process.ice" />
                <include name="Properties.ice" />
                <include name="Router.ice" />
                <include name="Connection.ice" />
            </fileset>
        </slice2javae>
    </target>

    <target name="compile" depends="generate">
        <mkdir dir="${lib.dir}"/>
        <mkdir dir="${cache.dir}"/>
	<depend srcdir="${generated.dir}:${src.dir}" destdir="${lib.dir}" cache="${cache.dir}"/>
	<!-- <javac srcdir="${src.dir}" destdir="${lib.dir}" -->
	<javac srcdir="${generated.dir}:${src.dir}" destdir="${lib.dir}"
	    debug="${debug}" optimize="${optimize}" deprecation="on">
<!--		<bootclasspath refid="bootclasspath"/>  -->
	</javac>
    </target>

    <target name="jar" depends="compile">
        <jar jarfile="${lib.dir}/IceE.jar" basedir="${lib.dir}" excludes="IceE.jar"/>
    </target>

    <target name="all" depends="jar">
        <ant inheritAll="false" dir="demo"/>
        <ant inheritAll="false" dir="test"/>
    </target>

    <target name="clean">
        <delete dir="${generated.dir}"/>
        <delete dir="${lib.dir}"/>
        <delete dir="${cache.dir}"/>
        <!--ant inheritAll="false" dir="demo" target="clean"/-->
        <!--ant inheritAll="false" dir="test" target="clean"/-->
    </target>

</project>
