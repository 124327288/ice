# **********************************************************************
#
# Copyright (c) 2003-2005 ZeroC, Inc. All rights reserved.
#
# This copy of Ice is licensed to you under the terms described in the
# ICE_LICENSE file included in this distribution.
#
# **********************************************************************

#
# If you want to compile TAO performance tests, set TAO_HOME to the
# TAO source distribution directory.
#
#TAO_ROOT	?=

#
# If you want to compile Ice performance tests, set ICE_HOME to the
# Ice source distribution directory
#
#ICE_HOME	?= 

#
# Define DEBUG as yes if you want to build with debug information.
#
#DEBUG			= yes

# ----------------------------------------------------------------------
# Don't change anything below this line!
# ----------------------------------------------------------------------

ifeq ($(ICE_HOME),)
    ifeq ($(shell test -d $(top_srcdir)/../ice/slice && echo 0),0)
	ICE_HOME=$(top_srcdir)/../ice
    endif
endif

ifeq ($(ICE_HOME),)
  ifeq ($(TAO_HOME),)
    $(error Please define ICE_HOME or TAO_HOME! See config/Make.rules)
  endif
endif

OPTIMIZE		= yes

SHELL			= /bin/sh

UNAME			:= $(shell uname)

slicedir		= $(ICE_HOME)/slice
configdir		= $(ICE_HOME)/config

ifdef ICE_HOME
   include	 $(configdir)/Make.rules.$(UNAME)
endif

CPPFLAGS		=
ICECPPFLAGS		= -I$(slicedir)
SLICE2CPPFLAGS		= $(ICECPPFLAGS)

ifeq ($(DEBUG),yes)
     CXXFLAGS		:= -g $(CXXFLAGS)
endif
LDFLAGS			= $(LDPLATFORMFLAGS) $(CXXFLAGS)

ICE_CPPFLAGS		?= -I$(ICE_HOME)/include
ICE_LIBS		?= -L$(ICE_HOME)/lib -lIce -lIceUtil -lSlice

SLICE2CPP		= $(ICE_HOME)/bin/slice2cpp

EVERYTHING		= all depend clean install

.SUFFIXES:
.SUFFIXES:		.cpp .o .py

all:: $(SRCS)

%.h %.cpp: %.ice
	rm -f $(*F).h $(*F).cpp
	$(SLICE2CPP) $(SLICE2CPPFLAGS) $(*F).ice	

.cpp.o:
	$(CXX) -c $(CPPFLAGS) $(CXXFLAGS) $<

clean::
	-rm -f $(TARGETS)
	-rm -f core *.o *.pyc *.bak

all:: $(SRCS) $(TARGETS)

depend:: $(SRCS) $(SLICE_SRCS)
	-rm -f .depend
	if test -n "$(SRCS)" ; then \
	    $(CXX) -DMAKEDEPEND -M $(CXXFLAGS) $(CPPFLAGS) $(SRCS) | \
	    $(configdir)/makedepend.py >> .depend; \
	fi

ifneq ($(TEMPLATE_REPOSITORY),)
clean::
	rm -fr $(TEMPLATE_REPOSITORY)
endif

install::

