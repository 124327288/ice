<icegrid>

  <application name="Test">

    <replica-group id="Test">
      <object identity="nonallocatable" type="::Test"/>
      <object identity="nonallocatable2" type="::NotAllocatable"/>
    </replica-group>

    <server-template id="Glacier2">
      <parameter name="id"/>
      <parameter name="endpoints"/>
      <parameter name="verifier"/>
      <parameter name="manager"/>

      <server id="${id}" exe="${ice.dir}/bin/glacier2router">
        <property name="Glacier2.Client.Endpoints" value="${endpoints}"/>
        <property name="Glacier2.Server.Endpoints" value="tcp -h 127.0.0.1"/>
        <property name="Glacier2.Admin.Endpoints" value="tcp -h 127.0.0.1"/>
        <property name="Glacier2.Admin.RegisterProcess" value="1"/>

        <property name="Glacier2.SessionManager" value="${manager}"/>
        <property name="Glacier2.SSLSessionManager" value="IceGrid/SSLSessionManager"/>
        <property name="Glacier2.PermissionsVerifier" value="${verifier}"/>
        <property name="Glacier2.Client.Trace.Reject" value="0"/>
      </server>
    </server-template>

    <node name="localnode">

      <server-instance template="Glacier2" id="Glacier2" 
                       endpoints="default -p 12347 -h 127.0.0.1 -t 10000" 
                       verifier="IceGrid/NullPermissionsVerifier"
                       manager="IceGrid/SessionManager"/>

      <server id="ObjectAllocation" exe="${test.dir}/server" activation="on-demand" pwd=".">
        <adapter name="Server" endpoints="default">
  	  <object identity="allocatable" type="::Test"/>
  	  <object identity="allocatablebis" type="::TestBis"/>
        </adapter>
      </server>

      <server id="ServerAllocation" exe="${test.dir}/server" activation="on-demand" pwd="." allocatable="true">
        <adapter name="Server" endpoints="default" id="ServerAlloc">
  	  <object identity="allocatable3" type="::TestServer1"/>
  	  <object identity="allocatable4" type="::TestServer2"/>

  	  <object identity="allocatable31" type="::TestMultipleByServer"/>
  	  <object identity="allocatable41" type="::TestMultipleByServer"/>
        </adapter>
      </server>

      <server id="ServerAllocation-1" exe="${test.dir}/server" activation="on-demand" pwd="." allocatable="true">
        <adapter name="Server" endpoints="default">
  	  <object identity="allocatable5" type="::TestMultipleServer"/>
        </adapter>
      </server>

      <server id="ServerAllocation-2" exe="${test.dir}/server" activation="on-demand" pwd="." allocatable="true">
        <adapter name="Server" endpoints="default">
  	  <object identity="allocatable6" type="::TestMultipleServer"/>
        </adapter>
      </server>
      
      <server id="ServerStress-1" exe="${test.dir}/server" activation="on-demand" pwd=".">
        <adapter name="Server" endpoints="default">
  	  <object identity="stress-1" type="::StressTest"/>
  	  <object identity="stress-2" type="::StressTest"/>
        </adapter>
      </server>

      <server id="ServerStress-2" exe="${test.dir}/server" activation="on-demand" pwd="." allocatable="true">
        <adapter name="Server" endpoints="default">
  	  <object identity="stress-3" type="::StressTest"/>
  	  <object identity="stress-4" type="::StressTest"/>
        </adapter>
      </server>

      <server id="ServerStress-3" exe="${test.dir}/server" activation="on-demand" pwd="." allocatable="true">
        <adapter name="Server" endpoints="default">
  	  <object identity="stress-5" type="::StressTest"/>
  	  <object identity="stress-6" type="::StressTest"/>
        </adapter>
      </server>

    </node>

  </application>

</icegrid>
