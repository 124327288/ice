<!--
 **********************************************************************

 Copyright (c) 2003-2005 ZeroC, Inc. All rights reserved.

 This copy of Ice is licensed to you under the terms described in the
 ICE_LICENSE file included in this distribution.

 **********************************************************************
-->

<icegrid>

  <application name="Simple">

     <variable name="icepatch.directory" value=""/>
     <variable name="icepatch.proxy" value="IcePatch2/server:tcp -p 13000 -h 192.168.0.10"/>
     <variable name="endpoint" value="tcp"/>

     <patch id="patch1" proxy="${icepatch.proxy}">
       <directory>${system}/simple</directory>
     </patch>

     <replicated-adapter id="ReplicatedHelloAdapter">
       <load-balancing type="adaptive" load-sample="1"/>
       <object identity="hello" type="::Demo::Hello"/>
     </replicated-adapter>

     <server-template id="ServerTemplate"> 
       <parameter name="name"/>
       <server id="${name}" exe="${system}/simple/server" activation="on-demand">
         <use-patch id="patch1"/>
	 <adapter name="Hello" endpoints="${endpoint}" register="true" id="ReplicatedHelloAdapter"/>
         <property name="Identity" value="hello"/>
       </server>
     </server-template>

     <service-template id="HelloService">
       <parameter name="name"/>
       <service name="${name}" entry="HelloService:create">
	 <adapter name="Hello" endpoints="tcp">
	   <object identity="hello2" type="::Demo::Hello"/>
	 </adapter>
	 <property name="Identity" value="hello2"/>
	 <property name="Name" value="${service}"/>
       </service>
     </service-template>

     <server-template id="IceBoxTemplate">
       <parameter name="name"/>
       <icebox id="${name}" exe="icebox" interpreter="icebox" endpoints="default">
         <env>LD_LIBRARY_PATH=$${LD_LIBRARY_PATH}:./simple</env>
         <env>PATH=./simple:$PATH:$TOTO</env>
         <env>TEST=$LKLK:$USER</env>
         <use-patch id="patch1"/>
         <service-instance template="HelloService" name="Hello"/>
         <service name="HelloService2" entry="HelloService:create">
	   <adapter name="Hello" endpoints="tcp">
	     <object identity="hello3" type="::Demo::Hello"/>
	   </adapter>
	   <property name="Identity" value="hello3"/>
	   <property name="Name" value="${service}"/>
         </service>
       </icebox>
     </server-template>
 
     <node name="node">
       <variable name="system" value="linux"/>
       <server-instance template="ServerTemplate" name="Server1"/>
     </node>

     <node name="node-win">
       <variable name="system" value="windows"/>
       <server-instance template="ServerTemplate" name="Server2"/>
     </node>

     <node name="node-macosx">
       <variable name="system" value="macosx"/>
       <variable name="endpoint" value="tcp -h 192.168.0.4"/>

       <server-instance template="ServerTemplate" name="Server3"/>
     </node>

  </application>

</icegrid>
