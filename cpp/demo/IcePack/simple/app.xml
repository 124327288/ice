<!--
 **********************************************************************

 Copyright (c) 2003-2005 ZeroC, Inc. All rights reserved.

 This copy of Ice is licensed to you under the terms described in the
 ICE_LICENSE file included in this distribution.

 **********************************************************************
-->

<icegrid>

  <application name="Simple">

     <variable name="icepatch.directory" value=""/>
     <variable name="icepatch.proxy" value="IcePatch2/server:tcp -p 13000"/>

     <patch id="patch1" proxy="${icepatch.proxy}" destination="${icepatch.directory}">
       <directory>simple</directory>
       <directory>hello/db</directory>
     </patch>

     <patch id="patch2" proxy="${icepatch.proxy}" destination="/home/benoit/icepatch_data/destination">
       <directory>simple</directory>
       <directory>hello</directory>
     </patch>

     <replicated-adapter id="ReplicatedHelloAdapter">
       <object identity="hello" type="::Demo::Hello"/>
     </replicated-adapter>

     <server-template id="ServerTemplate"> 
       <parameter name="name"/>
       <server id="${name}" exe="./simple/server" activation="on-demand">
         <use-patch id="patch1"/>
         <use-patch id="patch2"/>
	 <adapter name="Hello" endpoints="tcp" register="true" id="ReplicatedHelloAdapter"/>
         <property name="Identity" value="hello"/>
       </server>
     </server-template>

     <service-template id="HelloService">
       <parameter name="name"/>
       <service name="${name}" entry="HelloService:create">
	 <adapter name="Hello" endpoints="tcp">
	   <object identity="hello2" type="::Demo::Hello"/>
	 </adapter>
	 <property name="Identity" value="hello2"/>
	 <property name="Name" value="${service}"/>
       </service>
     </service-template>

     <server-template id="IceBoxTemplate">
       <parameter name="name"/>
       <icebox id="${name}" exe="icebox" interpreter="icebox" endpoints="default">
         <env>LD_LIBRARY_PATH=$${LD_LIBRARY_PATH}:./simple</env>
         <env>PATH=./simple:$PATH:$TOTO</env>
         <env>TEST=$LKLK:$USER</env>
         <use-patch id="patch1"/>
         <service-instance template="HelloService" name="Hello"/>
         <service name="HelloService2" entry="HelloService:create">
	   <adapter name="Hello" endpoints="tcp">
	     <object identity="hello3" type="::Demo::Hello"/>
	   </adapter>
	   <property name="Identity" value="hello3"/>
	   <property name="Name" value="${service}"/>
         </service>
       </icebox>
     </server-template>
 
     <node name="node">

       <server-instance template="ServerTemplate" name="Server1"/>
       <server-instance template="ServerTemplate" name="Server2"/>
       <server-instance template="ServerTemplate" name="Server3"/>
       <server-instance template="ServerTemplate" name="Server4"/>

       <server-instance template="IceBoxTemplate" name="IceBox1"/>

     </node>

  </application>

</icegrid>
