This file describes how to install the IceGrid registry, IceGrid node,
and Glacier2 router as Windows services.

1. Review and edit the appropriate configuration file
   (icegridregistry.cfg, icegridnode.cfg or
   glacier2router.cfg). Please make sure to review the notes in the
   Vista section below!

2. Create the account for the user that will run the service (the
   sample configuration files use the account 'iceuser'). Initially
   this user should be Administrator (see note below).

3. For the IceGrid registry or node, log on as 'iceuser' and
   create any required data/database directory.

4. Install the service, for example:

   > icegridregistry --install IceGridRegistry \
     --Ice.Config=C:\Ice-@ver@\config\icegridregistry.cfg

   Installing the service on Windows Vista with UAC enabled requires
   administrator privileges. In this case, run the command shell as
   administrator, right-click the command shell icon and select "Run
   as admin", then execute the installation command.

5. In the Windows Services panel, modify the properties of the new
   service. Change "Log on" to use the 'iceuser' account, instead of
   the Local System Account.

   On Windows Vista, it will not be possible to start the service
   unless there is a password associated with the selected account.

   On Windows Server 2003 and Windows Vista, the user account that
   runs IceGrid node must be a member of the local 'Performance
   Monitor Users' group for the node to be able to monitor the CPU
   usage of the system. See below for a complete set of instructions.

6. Start the service and verify that the service starts properly. Stop
   the service.

7. Downgrade the 'iceuser' account to a regular Users account (see
   note below). Restart the service.

Note:

'iceuser' needs to be Administrator the first time you start the
service if you log messages to the Windows Event Log (see the 
Ice.UseEventLog property).


Windows Server 2003 and Windows Vista
-------------------------------------

The user account that runs the IceGrid node needs to be a member of
the local 'Performance Monitor Users' group so that the node can
monitor CPU usage. This is only necessary if you intend to use an
IceGrid load-balancing policy that relies on CPU usage.

The instructions below were obtained from a Microsoft article:

http://technet2.microsoft.com/WindowsVista/en/library/ab3b2cfc-b177-43ec-8a4d-0bfac62d88961033.mspx?mfr=true

First grant the user account "Log on as a batch job" rights.

To assign the "Log on as a batch job" user right to the Performance
Log Users group:
	
1. Click Start, click in the Search box, type secpol.msc, and press
   ENTER. The Local Security Policy snap-in will open in Microsoft
   Management Console.

2. In the navigation pane, expand Local Policies and click User Rights
   Assignment.

3. In the console pane, right-click Log on as a batch job and click
   Properties.

4. In the Properties page, click Add User or Group.

5. In the Select Users or Groups dialog box, click Object Types.
   Select Groups in the Object Types dialog box and click OK.

6. Type Performance Log Users in the Select Users or Groups dialog box
   and then click OK.

7. In the properties page, click OK.

Next to update the group membership:

Open the computer management tool. Select "Local Users and Groups",
then "Groups", then "Performance Log Users". Then add the user to the
members of this group.

Or under an admin rights command shell:

net localgroup "Performance Log Users" "<user>" /add

Once this is done it is necessary to logout and then login again if
you are modifying the rights of the currently logged in user.

Windows Vista and Permissions
-----------------------------

Under Vista you must pay careful attention to the permissions of the
data and output directories. In the default icegridnode.cfg and
icegridregistry.cfg these are:

IceGrid.Node.Data=C:\Documents and Settings\iceuser\Application Data\ZeroC\icegrid\node1
IceGrid.Node.Output=C:\Documents and Settings\iceuser\Application Data\ZeroC\icegrid\node1
IceGrid.Registry.Data=C:\Documents and Settings\iceuser\Application Data\ZeroC\icegrid\registry

You can run into permissions inheritance problems if you blindly
create directories on the file system and the node and registry
service will fail to start.

To use the default location as described above:

Start a command shell

> cd "\Documents and Settings\iceuser\Application Data\"
> mkdir ZeroC

Now start up the file explorer. Enter in the address bar

C:\Documents and Settings\iceuser\Application Data\

Create a directory icegrid. Now right-click on the directory, select
properties, and select the security tab.  Select Advanced and
Edit. Unselect "Include inheritable permissions from this object's
parent", select Copy. Now remove all Permission entries. Next add a
permission entry for iceuser, and select "Full control". Select ok,
and you are done!

Now you can create the registry and node1 subdirectories without any
further action and the correct permissions will be used.
