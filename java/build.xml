<project name="main" default="all" basedir=".">

    <!-- install slice2java task -->
    <taskdef name="slice2java" classpath="ant" classname="Slice2JavaTask" />

    <!-- install slice2freezej task -->
    <taskdef name="slice2freezej" classpath="ant" classname="Slice2FreezeJTask" />

    <!-- set global properties for this build -->
    <property name="slice.dir" value="../ice/slice"/>
    <property name="src.dir" value="src"/>
    <property name="lib.dir" value="lib"/>
    <property name="generated.dir" value="generated"/>
    <property name="tags.dir" value="${generated.dir}/.tags"/>
    <property name="debug" value="on"/>
    <property name="optimize" value="off"/>

    <target name="init">
        <!-- Create the time stamp -->
        <tstamp/>
    </target>

    <target name="generate" depends="init">
        <!-- Create the output directory for generated code -->
        <mkdir dir="${generated.dir}"/>
        <mkdir dir="${tags.dir}"/>
        <slice2java tagdir="${tags.dir}" outputdir="${generated.dir}">
            <includepath>
                <pathelement path="${slice.dir}" />
            </includepath>
            <fileset dir="${slice.dir}/Ice">
                <include name="BuiltinSequences.ice" />
                <include name="Communicator.ice" />
                <include name="Current.ice" />
                <include name="Identity.ice" />
                <include name="LocalException.ice" />
                <include name="Logger.ice" />
                <include name="ObjectAdapter.ice" />
                <include name="ObjectFactory.ice" />
                <include name="Properties.ice" />
                <include name="RequestQueue.ice" />
                <include name="Router.ice" />
                <include name="ServantLocator.ice" />
                <include name="Stream.ice" />
            </fileset>
            <fileset dir="${slice.dir}/Glacier">
                <include name="Glacier.ice" />
            </fileset>
            <fileset dir="${slice.dir}/Freeze">
                <include name="DB.ice" />
                <include name="DBException.ice" />
                <include name="Evictor.ice" />
            </fileset>
        </slice2java>
        <slice2freezej tagdir="${tags.dir}" outputdir="${generated.dir}">
            <includepath>
                <pathelement path="${slice.dir}" />
            </includepath>
            <fileset dir="${slice.dir}/Ice">
                <include name="Identity.ice"/>
            </fileset>
            <dict name="Freeze.IdentityObjectDict" key="Ice::Identity" value="Object"/>
        </slice2freezej>
    </target>

    <target name="compile" depends="generate">
        <mkdir dir="${lib.dir}"/>
        <javac srcdir="${generated.dir}:${src.dir}" destdir="${lib.dir}"
            source="1.4" debug="${debug}" optimize="${optimize}"/>
    </target>

    <target name="jar" depends="compile">
        <jar jarfile="${lib.dir}/Ice.jar" basedir="${lib.dir}"
            excludes="Ice.jar"/>
    </target>

    <target name="all" depends="jar">
        <ant inheritAll="false" dir="demo"/>
        <ant inheritAll="false" dir="test"/>
    </target>

    <target name="clean">
        <delete dir="${tags.dir}"/>
        <delete dir="${generated.dir}"/>
        <delete dir="${lib.dir}"/>
        <ant inheritAll="false" dir="demo" target="clean"/>
        <ant inheritAll="false" dir="test" target="clean"/>
    </target>

</project>
