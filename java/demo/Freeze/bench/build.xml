<!--

Copyright (c) 2002
ZeroC, Inc.
Billerica, MA, USA

All Rights Reserved.

Ice is free software; you can redistribute it and/or modify it under
the terms of the GNU General Public License version 2 as published by
the Free Software Foundation.

-->
<project name="demo_Freeze_bench" default="all" basedir=".">

    <!-- get access to env variables globally -->
    <property environment="env" />

    <!-- set global properties for this build -->
    <property name="top.dir" value="../../.."/>
    <property name="lib.dir" value="${top.dir}/lib"/>
    <property name="class.dir" value="classes"/>
    <property name="generated.dir" value="generated"/>

    <!-- install slice2java task -->
    <taskdef name="slice2java" classpath="${top.dir}/ant" classname="Slice2JavaTask" />

    <!-- install slice2freezej task -->
    <taskdef name="slice2freezej" classpath="${top.dir}/ant" classname="Slice2FreezeJTask" />

    <target name="init">
        <!-- Create the time stamp -->
        <tstamp/>

        <!-- Define the slice.dir property -->
        <condition property="slice.dir" value="${top.dir}/slice">
            <available file="${top.dir}/slice"/>
        </condition>
        <condition property="slice.dir" value="${env.ICE_HOME}/slice">
            <not>
                <available file="${top.dir}/slice"/>
            </not>
        </condition>
    </target>

    <target name="generate" depends="init">
        <!-- Create the output directory for generated code -->
        <mkdir dir="${generated.dir}"/>
        <slice2java outputdir="${generated.dir}">
            <includepath>
                <pathelement path="${slice.dir}" />
            </includepath>
            <fileset dir="." includes="Test.ice"/>
        </slice2java>
        <slice2freezej outputdir="${generated.dir}">
            <includepath>
                <pathelement path="${slice.dir}" />
            </includepath>
	    <dict name="IntIntMap" key="int" value="int"/>
        </slice2freezej>
        <slice2freezej outputdir="${generated.dir}">
            <includepath>
                <pathelement path="${slice.dir}" />
            </includepath>
            <fileset dir="." includes="Test.ice"/>
	    <dict name="Struct1Struct2Map" key="Struct1" value="Struct2"/>
	    <dict name="Struct1Class1Map" key="Struct1" value="Class1"/>
	    <dict name="Struct1ObjectMap" key="Struct1" value="Object"/>
        </slice2freezej>
    </target>

    <target name="compile" depends="generate">
        <mkdir dir="${class.dir}"/>
        <javac srcdir="${generated.dir}" destdir="${class.dir}"
            source="1.4" classpath="${lib.dir}" debug="${debug}"/>
        <javac srcdir="." destdir="${class.dir}" source="1.4"
            classpath="${lib.dir}" excludes="generated/**" debug="${debug}"/>
    </target>

    <target name="all" depends="compile"/>

    <target name="clean">
        <delete dir="${generated.dir}"/>
        <delete dir="${class.dir}"/>
    </target>

</project>
