// **********************************************************************
//
// Copyright (c) 2003-2014 ZeroC, Inc. All rights reserved.
//
// This copy of Ice is licensed to you under the terms described in the
// ICE_LICENSE file included in this distribution.
//
// **********************************************************************

slice {
	java {
		include = ["${projectDir}", "${sliceDir}"]
		srcDir = '.'
	}
	freezej {
		files = [file("Test.ice")]
		include = ["${sliceDir}"]
		args = "--ice"
		dict {
			IntIntMap {
				javaType = "Demo.IntIntMap"
				key = "int"
				value = "int"
			}
			IndexedIntIntMap {
				javaType = "Demo.IndexedIntIntMap"
				key = "int"
				value = "int"
				index = [[:]]
			}
			Struct1Struct2Map {
				javaType = "Demo.Struct1Struct2Map"
				key = "Demo::Struct1"
				value = "Demo::Struct2"
			}
			Struct1Class1Map {
				javaType = "Demo.Struct1Class1Map"
				key = "Demo::Struct1"
				value = "Demo::Class1"
			}
			Struct1ObjectMap {
				javaType = "Demo.Struct1ObjectMap"
				key = "Demo::Struct1"
				value = "Object"
			}
			IndexedStruct1Struct2Map {
				javaType = "Demo.IndexedStruct1Struct2Map"
				key = "Demo::Struct1"
				value = "Demo::Struct2"
				index = [[ member: 's', case: 'false'],
						 [ member: 's1']]
			}
			IndexedStruct1Class1Map {
				javaType = "Demo.IndexedStruct1Class1Map"
				key = "Demo::Struct1"
				value = "Demo::Class1"
				index = [[ member: 's', case: 'true']]
			}
		}
	}
}

sourceSets {
	main {
		java {
			srcDir '.'
			output.classesDir "${buildDir}/classes"
		}
	}
}

dependencies {
	compile localDependency("ice")
	compile localDependency("freeze")
	compile files(dbJar)
}

// Create a jar for the client & server which includes everything in the demo.
task clientJar(type: Jar) {
	version = ""
   	baseName = "client"
    from(sourceSets.main.output) {
    	include "**"
    }
}

clientJar {
    manifest {
        attributes("Main-Class": "Client")
        attributes("Class-Path": configurations.compile.resolve().collect { it.toURI() }.join(' '))
    }
}

artifacts {
	archives clientJar;
}

idea.module {
	excludeDirs -= file(buildDir)
	buildDir.listFiles({d, f ->f != 'generated-src'} as FilenameFilter).each { excludeDirs += it }
}
