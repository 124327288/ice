<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Build" ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">  

    <PropertyGroup Condition="Exists('$(ICE_HOME)')">
        <IceHome>$(ICE_HOME)</IceHome>
    </PropertyGroup>
  
    <!-- If IceHome isn't set use the default value -->
    <PropertyGroup Condition="!Exists('$(IceHome)')">
        <IceHome>$(Registry:HKEY_LOCAL_MACHINE\Software\ZeroC\Ice 3.6.0@InstallDir)</IceHome>
    </PropertyGroup>

    <!-- Check if IceHome denotes a source distribution -->
    <PropertyGroup Condition="Exists('$(IceHome)\cpp\bin')">
        <IceSourceHome>$(IceHome)</IceSourceHome>
    </PropertyGroup>

    <Choose>
        <When Condition="'$(ApplicationType)' == 'Windows Store'">
            <PropertyGroup Condition="!Exists('$(IceSourceHome)')">
                <IceSDKDirectory>$(IceHome)\SDKs</IceSDKDirectory>
            </PropertyGroup>
            
            <PropertyGroup Condition="Exists('$(IceSourceHome)')">
                <IceSDKDirectory>$(IceHome)\cpp\SDKs</IceSDKDirectory>
            </PropertyGroup>
            
            <PropertyGroup Condition="'$(Configuration)' == 'Debug'">
                <ConfigurationPrefix>Debug</ConfigurationPrefix>
            </PropertyGroup>

            <PropertyGroup Condition="'$(Configuration)' == 'Release'">
                <ConfigurationPrefix>Retail</ConfigurationPrefix>
            </PropertyGroup>

            <PropertyGroup>
                <IncludePath>$(IceSDKDirectory)\$(TargetPlatformIdentifier)\v$(TargetPlatformVersion)\ExtensionSDKs\Ice\3.6\Designtime\CommonConfiguration\Neutral\include;$(IncludePath)</IncludePath>
                <LibraryPath>$(IceSDKDirectory)\$(TargetPlatformIdentifier)\v$(TargetPlatformVersion)\ExtensionSDKs\Ice\3.6\Designtime\$(ConfigurationPrefix)\$(PlatformTarget);$(LibraryPath)</LibraryPath>
                <SDKReferenceDirectoryRoot>$(IceSDKDirectory);$(SDKReferenceDirectoryRoot);$(ExtensionSDKDirectoryRoot)</SDKReferenceDirectoryRoot>
            </PropertyGroup>
            
            <ItemGroup>
                <BuildMacro Include="IceHome">
                    <Value>$(IceHome)</Value>
                    <EnvironmentVariable>true</EnvironmentVariable>
                </BuildMacro>
            </ItemGroup>
        </When>
        
        <When Condition="'$(ApplicationType)' != 'Windows Store'">
            <PropertyGroup Condition="!Exists('$(IceSourceHome)')">
                <IceInclude>$(IceHome)\include</IceInclude>
                <IceToolsBin>$(IceHome)\bin</IceToolsBin>
            </PropertyGroup>
            
            <PropertyGroup Condition="!Exists('$(IceSourceHome)') And '$(Platform)' == 'Win32' And '$(PlatformToolset)' == 'v110'">
                <IceLib>$(IceHome)\lib\vc110</IceLib>
                <IceBin>$(IceHome)\bin\vc110</IceBin>
            </PropertyGroup>
            
            <PropertyGroup Condition="!Exists('$(IceSourceHome)') And '$(Platform)' != 'Win32' And '$(PlatformToolset)' == 'v110'">
                <IceLib>$(IceHome)\lib\vc110\$(Platform)</IceLib>
                <IceBin>$(IceHome)\bin\vc110\$(Platform)</IceBin>
            </PropertyGroup>
            
            <PropertyGroup Condition="!Exists('$(IceSourceHome)') And '$(Platform)' == 'Win32' And '$(PlatformToolset)' == 'v120'">
                <IceLib>$(IceHome)\lib</IceLib>
                <IceBin>$(IceHome)\bin</IceBin>
            </PropertyGroup>
            
            <PropertyGroup Condition="!Exists('$(IceSourceHome)') And '$(Platform)' != 'Win32' And '$(PlatformToolset)' == 'v120'">
                <IceLib>$(IceHome)\lib\$(Platform)</IceLib>
                <IceBin>$(IceHome)\bin\$(Platform)</IceBin>
            </PropertyGroup>

            <PropertyGroup Condition="Exists('$(IceSourceHome)')">
                <IceInclude>$(IceHome)\cpp\include</IceInclude>
                <IceLib>$(IceHome)\cpp\lib</IceLib>
                <IceBin>$(IceHome)\cpp\bin</IceBin>
                <IceToolsBin>$(IceHome)\cpp\bin</IceToolsBin>
            </PropertyGroup>

            <PropertyGroup>
                <IncludePath>$(IceInclude);$(IncludePath)</IncludePath>
                <LibraryPath>$(IceLib);$(LibraryPath)</LibraryPath> 
                <ExecutablePath>$(IceBin);$(ExecutablePath)</ExecutablePath>
            </PropertyGroup>
            
            <ItemGroup>
                <BuildMacro Include="IceHome">
                    <Value>$(IceHome)</Value>
                    <EnvironmentVariable>true</EnvironmentVariable>
                </BuildMacro>
                <BuildMacro Include="IceInclude">
                    <Value>$(IceInclude)</Value>
                    <EnvironmentVariable>true</EnvironmentVariable>
                </BuildMacro>
                <BuildMacro Include="IceLib">
                    <Value>$(IceLib)</Value>
                    <EnvironmentVariable>true</EnvironmentVariable>
                </BuildMacro>
                <BuildMacro Include="IceBin">
                    <Value>$(IceBin)</Value>
                    <EnvironmentVariable>true</EnvironmentVariable>
                </BuildMacro>
                <BuildMacro Include="IceToolsBin">
                    <Value>$(IceToolsBin)</Value>
                    <EnvironmentVariable>true</EnvironmentVariable>
                </BuildMacro>
            </ItemGroup>
        </When>
    </Choose>
</Project>
